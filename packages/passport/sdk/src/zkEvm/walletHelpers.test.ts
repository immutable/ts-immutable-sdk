import { BigNumber, Wallet } from 'ethers';
import { getSignedMetaTransactions } from './walletHelpers';

describe('getSignedMetaTransactions', () => {
  // NOTE: Generated with https://github.com/immutable/wallet-contracts/blob/348add7d2fde13d8f7f83aae0882ad2d97546d72/tests/ImmutableDeployment.spec.ts#L69
  it('should correctly generate the signature for a given transaction', async () => {
    const transactions = [
      {
        delegateCall: false,
        revertOnError: true,
        gasLimit: 1000000,
        to: '0x3C44CdDdB6a900fa2b585dd299e03d12FA4293BC',
        value: '500000000000000000',
        data: '0x',
      },
    ];
    const nonce = 0;
    const chainId = 1779;
    // SCW addr
    const walletAddress = '0x7EEC32793414aAb720a90073607733d9e7B0ecD0';
    // User EOA private key
    const signer = new Wallet('0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80');

    const signature = await getSignedMetaTransactions(
      transactions,
      nonce,
      BigNumber.from(chainId),
      walletAddress,
      signer,
    );

    expect(signature).toBe('0x7a9a1628000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000180000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000f42400000000000000000000000003c44cdddb6a900fa2b585dd299e03d12fa4293bc00000000000000000000000000000000000000000000000006f05b59d3b2000000000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004600010001904a25850e09260d88f3fc46fab4901e7c979fc583fe9d30a12c51ba5636355a1351b8ce823f765568d8b88cddd9c8ede9f1cc17dfd7ca953e05ecbbbdf8f51e1c020000000000000000000000000000000000000000000000000000');
  });
});
