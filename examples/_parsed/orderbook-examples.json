{
  "create-listing-with-nextjs": {
    "tutorial": "# Create Listing with Next.js\n\n## Introduction\nThis example application demonstrates how to use the Immutable Orderbook SDK to create listings for both ERC721 and ERC1155 tokens using Next.js. It showcases the process of connecting to Passport for authentication, preparing listings, approving transactions, and creating listings on the Immutable marketplace. \n\n[View example app on GitHub](https://github.com/immutable/ts-immutable-sdk/tree/main/examples/orderbook/create-listing-with-nextjs)\n\n## Features Overview\n- Connecting to Immutable Passport for authentication\n- Creating ERC721 token listings\n- Creating ERC1155 token listings\n- Supporting both native token and ERC20 token payment options\n- Adding optional marketplace fees to listings\n- Handling the complete listing creation flow (prepare, approve, sign, create)\n\n## SDK Integration Details\n\n### Connecting to Passport\n[View on GitHub](https://github.com/immutable/ts-immutable-sdk/blob/main/examples/orderbook/create-listing-with-nextjs/src/app/create-listing-with-erc721/page.tsx#L47-L57)\n\n**Feature Name**: Passport Authentication\n\n**Implementation**:\n```typescript\n// fetch the Passport provider from the Passport instance\nconst [passportProvider, setPassportProvider] = useState<Provider>();\n\nuseEffect(() => {\n  const fetchPassportProvider = async () => {\n    const passportProvider = await passportInstance.connectEvm();\n    setPassportProvider(passportProvider);\n  };\n  fetchPassportProvider();\n}, []);\n\n// create the BrowserProvider using the Passport provider\nconst browserProvider = useMemo(() => passportProvider ? new BrowserProvider(passportProvider) : undefined, [passportProvider]);\n```\n\n**Explanation**: The application connects to Immutable Passport to authenticate users and obtain a provider that can be used for blockchain interactions. It uses `passportInstance.connectEvm()` to obtain a provider, which is then wrapped in a BrowserProvider from ethers.js to enable Web3 operations.\n\n### Creating an ERC721 Listing\n[View on GitHub](https://github.com/immutable/ts-immutable-sdk/blob/main/examples/orderbook/create-listing-with-nextjs/src/app/create-listing-with-erc721/page.tsx#L163-L188)\n\n**Feature Name**: ERC721 Listing Preparation\n\n**Implementation**:\n```typescript\nconst prepareERC721Listing = async (): Promise<orderbook.PrepareListingResponse> => {\n  // build the sell item\n  const sell: ERC721Item = {\n    contractAddress: sellItemContractAddress,\n    tokenId: sellItemTokenID,\n    type: \"ERC721\",\n  };\n\n  // build the buy item\n  const buy =\n    buyItemType === \"Native\"\n      ? ({\n          amount: buyItemAmount,\n          type: \"NATIVE\",\n        } as NativeItem)\n      : ({\n          amount: buyItemAmount,\n          type: \"ERC20\",\n          contractAddress: buyItemContractAddress,\n        } as ERC20Item);\n\n  // build the prepare listing parameters\n  const prepareListingParams: PrepareListingParams = {\n    makerAddress: accountsState[0],\n    buy,\n    sell,\n  };\n\n  // invoke the orderbook SDK to prepare the listing\n  return await orderbookSDK.prepareListing(prepareListingParams);\n};\n```\n\n**Explanation**: The application prepares an ERC721 listing by creating a sell item that specifies the ERC721 token details (contract address and token ID) and a buy item that represents what the seller wants to receive (either a native token or an ERC20 token). These parameters are passed to the `prepareListing` method of the Orderbook SDK to obtain the necessary information for the next steps in the listing process.\n\n### Creating an ERC1155 Listing\n[View on GitHub](https://github.com/immutable/ts-immutable-sdk/blob/main/examples/orderbook/create-listing-with-nextjs/src/app/create-listing-with-erc1155/page.tsx#L169-L195)\n\n**Feature Name**: ERC1155 Listing Preparation\n\n**Implementation**:\n```typescript\nconst prepareERC1155Listing = async (): Promise<orderbook.PrepareListingResponse> => {\n  // build the sell item\n  const sell: ERC1155Item = {\n    contractAddress: sellItemContractAddress,\n    tokenId: sellItemTokenID,\n    amount: sellItemQty,\n    type: \"ERC1155\",\n  };\n\n  // build the buy item\n  const buy =\n    buyItemType === \"Native\"\n      ? ({\n          amount: buyItemAmount,\n          type: \"NATIVE\",\n        } as NativeItem)\n      : ({\n          amount: buyItemAmount,\n          type: \"ERC20\",\n          contractAddress: buyItemContractAddress,\n        } as ERC20Item);\n\n  // build the prepare listing parameters\n  const prepareListingParams: PrepareListingParams = {\n    makerAddress: accountsState[0],\n    buy,\n    sell,\n  };\n\n  // invoke the orderbook SDK to prepare the listing\n  return await orderbookSDK.prepareListing(prepareListingParams);\n};\n```\n\n**Explanation**: Similar to the ERC721 listing preparation, the ERC1155 listing preparation creates a sell item for an ERC1155 token, which includes an additional `amount` parameter that specifies how many tokens are being sold. This allows for the sale of multiple fungible tokens in a single listing.\n\n### Approving Token Transfers\n[View on GitHub](https://github.com/immutable/ts-immutable-sdk/blob/main/examples/orderbook/create-listing-with-nextjs/src/app/utils/listing.ts#L5-L28)\n\n**Feature Name**: Approving Token Transfers for the Immutable Marketplace\n\n**Implementation**:\n```typescript\nexport const signAndSubmitApproval = async (\n  provider: BrowserProvider,\n  listing: orderbook.PrepareListingResponse,\n): Promise<void> => {\n  // get your user's Web3 wallet, e.g. MetaMask, Passport, etc\n  const signer = await provider.getSigner();\n\n  // If the user hasn't yet approved the Immutable Seaport contract to transfer assets from this\n  // collection on their behalf they'll need to do so before they create an order\n  const approvalActions = listing.actions.filter(\n    (action): action is orderbook.TransactionAction =>\n      action.type === orderbook.ActionType.TRANSACTION,\n  );\n\n  for (const approvalAction of approvalActions) {\n    const unsignedTx = await approvalAction.buildTransaction();\n    const receipt = await signer.sendTransaction(unsignedTx);\n    await receipt.wait();\n  }\n\n  return;\n};\n```\n\n**Explanation**: Before a listing can be created, the seller must approve the Immutable Seaport contract to transfer their tokens. This function extracts the approval transactions from the prepared listing response, builds unsigned transactions for each approval, sends them using the user's wallet, and waits for the transactions to be confirmed.\n\n### Signing a Listing\n[View on GitHub](https://github.com/immutable/ts-immutable-sdk/blob/main/examples/orderbook/create-listing-with-nextjs/src/app/utils/listing.ts#L30-L54)\n\n**Feature Name**: Signing a Listing Order\n\n**Implementation**:\n```typescript\nexport const signListing = async (\n  provider: BrowserProvider,\n  listing: orderbook.PrepareListingResponse,\n): Promise<string> => {\n  // get your user's Web3 wallet, e.g. MetaMask, Passport, etc\n  const signer = await provider.getSigner();\n\n  // For an order to be created (and subsequently filled), Immutable needs a valid signature for the order data.\n  // This signature is stored off-chain and is later provided to any user wishing to fulfil the open order.\n  // The signature only allows the order to be fulfilled if it meets the conditions specified by the user that created the listing.\n  const signableAction = listing.actions.find(\n    (action): action is orderbook.SignableAction =>\n      action.type === orderbook.ActionType.SIGNABLE,\n  )!;\n\n  const signature = await signer.signTypedData(\n    signableAction.message.domain,\n    signableAction.message.types,\n    signableAction.message.value,\n  );\n\n  return signature;\n};\n```\n\n**Explanation**: After approving token transfers, the seller must sign the listing order to ensure authenticity. This function finds the signable action from the prepared listing response, gets the necessary data for a typed signature (EIP-712), and uses the user's wallet to sign the data. The resulting signature is returned for use in the final step of listing creation.\n\n### Creating a Listing with Optional Marketplace Fees\n[View on GitHub](https://github.com/immutable/ts-immutable-sdk/blob/main/examples/orderbook/create-listing-with-nextjs/src/app/utils/listing.ts#L56-L80)\n\n**Feature Name**: Creating a Listing with Optional Marketplace Fees\n\n**Implementation**:\n```typescript\nexport const createListing = async (\n  client: orderbook.Orderbook,\n  preparedListing: orderbook.PrepareListingResponse,\n  orderSignature: string,\n  makerEcosystemFee?: {\n    recipientAddress: string;\n    amount: string;\n  },\n): Promise<string> => {\n  const order = await client.createListing({\n    orderComponents: preparedListing.orderComponents,\n    orderHash: preparedListing.orderHash,\n    orderSignature,\n    // Optional maker marketplace fee\n    makerFees: makerEcosystemFee ? [\n      {\n        recipientAddress: makerEcosystemFee.recipientAddress, // Replace address with your own marketplace address\n        amount: makerEcosystemFee.amount,\n      },\n    ] : [],\n  });\n  return order.result.id;\n};\n```\n\n**Explanation**: The final step in the listing process is to create the listing on the Immutable marketplace. This function uses the prepared listing data, order hash, and signature to call the `createListing` method of the Orderbook SDK. It also supports adding optional marketplace fees, which allow the marketplace operator to collect a percentage of the sale amount when the listing is filled.\n\n## Running the App\n\n[View example app on GitHub](https://github.com/immutable/ts-immutable-sdk/tree/main/examples/orderbook/create-listing-with-nextjs)\n\n### Prerequisites\n- Node.js v18 or later\n- pnpm v8 or later\n- An Immutable Hub account to set up your environment variables. [Sign up on Immutable Hub](https://hub.immutable.com/)\n\n### Setup Environment\n1. Copy the `.env.example` file to `.env.local`\n2. Fill in your Immutable Hub credentials in the `.env.local` file:\n   ```\n   NEXT_PUBLIC_PUBLISHABLE_KEY=<your-publishable-key>\n   NEXT_PUBLIC_CLIENT_ID=<your-client-id>\n   ```\n\n### Steps to Run the App\n1. Install dependencies:\n   ```bash\n   pnpm install\n   ```\n2. Start the development server:\n   ```bash\n   pnpm dev\n   ```\n3. Open your browser and navigate to http://localhost:3000\n\n## Summary\nThis example application demonstrates the complete flow for creating listings for both ERC721 and ERC1155 tokens on the Immutable marketplace using the Orderbook SDK. It shows how to:\n\n- Connect to Passport for user authentication\n- Prepare listings for different token types\n- Support both native and ERC20 token payments\n- Handle the approval process for token transfers\n- Sign and create listings with optional marketplace fees\n\nBy following this example, developers can understand how to integrate the Immutable Orderbook SDK into their Next.js applications to enable token listings. ",
    "metadata": {
      "title": "Create Listing with Next.js",
      "description": "An example application demonstrating how to use the Immutable Orderbook SDK to create listings for ERC721 and ERC1155 tokens using Next.js",
      "keywords": [
        "Immutable",
        "SDK",
        "Orderbook",
        "Listing",
        "Next.js",
        "ERC721",
        "ERC1155",
        "Passport"
      ],
      "tech_stack": [
        "Next.js",
        "React",
        "TypeScript",
        "Immutable SDK",
        "Ethers.js",
        "Biom3"
      ],
      "product": "Orderbook",
      "programming_language": "TypeScript"
    }
  }
}